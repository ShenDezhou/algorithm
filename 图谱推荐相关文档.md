#tupu recommender 点击率预估数据流程

1.线下实验代码位置：10.144.59.51:/search/odin/huangyue/wap_ctr_prediction/build_new.sh(整体训练+评测流程)   evaluate.sh(评测代码) 密码:noSafeNoWork@2016
2.线上数据制作位置:/search/odin/huangyue/wap_ctr_prediction/mk_entityFeature.sh 目前该流程未加入实体更新时间的更新，需要后续加入，百科实体数据更新这份数据的获取可以咨询黄跃，目前线上并未加入数据更新，后续需提单子建立更新流程
3.训练过程与训练数据思路，详细过程参加上述代码，我做实验的每一步都保留了：
    1.训练数据获取：正例：点击率较高的query-entity(用click.info.test数据)，负例：随机抽取没有点击的query-entity
    2.特征选取:由于我们的数据是实体推荐，所以特征选择从3个方面:query：hint返回的6个hq值，entity：ctr、百科pv、百科更新时间、类别特征（one-hot，73维）、是否有tag、实体图片得分、实体名称长度（one-hot），query-entity:qdb四路数据得分，其中统计数值特征做了取sigmoid的操作，使用平均值填充缺失数据，非统计特征进行了没有值得填充处理。
    3.train:使用Logistic Regression +L1正则，由于我们的模型特征较少，所以L1正则基本够用，而且前期没有进行特征选择，所以L1正则还有辅助选择特征的作用。
4.其他也可以参考这个ppt，ctr预估分享
query、query-entity相关特征获取流程
可使用sggp打压力工具获取query、query-entity特征

#热门新闻数据推荐结果质量过滤逻辑

目标：由于热门新闻很多都很长尾，导致tupuhint给的hintquery不相关，后续推荐结果也导致不相关，使用在searchhub能够拿到网页返回的结果，通过看推荐结果与网页返回结果的相关性可以判定推荐效果是否ok。

方法：
整体方法：先从vr获取到人工运营的新闻热词，然后判断这些热词hint给出的结果或者最终给出的推荐实体的结果是否ok，如果不ok则直接干掉。
1.新闻数据制作代码:
   这里面包括所有的数据处理流程，目前该流程只是线下处理流程，线上数据已经打包为docker流程，
   docker流程数据制作位置:
   运行位置:使用第一台机器build完成之后打包成docker镜像，然后再使用clone到93.143的机器上运行，运行脚本为:
   每15分钟产出一次数据，运维自动同步到线上tupuhint机器上。tupuhint在判断query是新闻词时会在结果中填充hintlevel=1,如果不是新闻词，则hintlevel=0

2.tupuhint处理方法：
    人工取了100条新闻数据，选取query长度，得分，词性等特征，训练决策树，进行过滤.
    训练代码:这个代码主要是数据处理，特征抽取，模型训练使用的是weka的j48模型，在windows上进行的。
    线上代码:

3.searchhub处理方法：
由于hint过滤并不能完全搞定，因此在searchhub也做了一版过滤，这里主要用推荐的实体的topic向量和网页结果的topic向量比较，当拿到推荐结果中hintlevel=1的情况下，走过滤逻辑，把topic过滤的阈值卡的更严。
代码: searchhub的

#TEXT数据制作流程

text数据概述：挖掘新增的高质量query(高pv)，获取query文本(搜索结果页前几条结果的title、summary)，query文本与实体文本倒排求交获取top实体，计算query与实体相关性

text数据是每周更新一次

一、query、query文本、实体文本制作流程
数据流程位置：
入口脚本：
代码流程：
1）计算挖掘新增的高质query，最后生成新增query文件：hq_add
2) 抓取新增query的搜索结果页面
3)解析query搜索结果页，获取搜索结果页文档的title、summary制作成query文本向量
4）倒排求交计获取query召回的相关实体，结果为doc.term.text.0
这个脚本的逻辑是将query的文本向量发送到的query与实体倒排求交的服务，返回query与候选实体相关度打分
服务位置：

二、计算query与entity文本相关度(版本2)
使用matchlstm深度模型计算query与entity的文本相关度
代码位置：
代码逻辑流程：
1）从同步query搜索结果页，doc.term.text.0数据
2）解析query网页结果，获取query文本数据，并分词
3）使用深度模型计算query与候选实体的文本相关性
4）将结果去重、排序、归一化后存储在hdfs上，路径为晨曦集群：

计算query与entity文本相关度(版本1)
使用dnn模型计算query与entity的文本相关度
代码位置：

