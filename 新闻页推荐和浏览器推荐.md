#finaliehint新闻数据例行制作
一、finaliehint新闻数据例行制作：
相关功能：
        1.      从PA日志提取出网页爬虫新抓取的新闻url
        2.      用dbnetget工具对步骤1的url获取到pages，并抽取出所需字段如content_title（PA组提取的title）、content、抓取时间、是否低质量、是否垃圾页面、图片url等
        3.      对content_title和content分词，并融合到一起计算文本向量、lda向量、word2vec向量
        4.      根据每个新闻url的word2vec向量计算所属类别（全量新闻数据通过分层聚类，分为80*100个类别），结果保存在tmp/ cls.add中并追加到data/ clsnews3（最终输出之一）中
        5.      固化新闻图片，并去除二维码图片
        6.      新闻title截断，将长title截断成为短title
        7.      验证数据正确性，并将最终结果保存在tmp/ allhex（最终输出之一）中
        8.      将最终数据SCP到目录下
     
新闻页推荐和插件推荐的算法基本相同，不同点：
        1. 插件推荐只用了页面title，新闻页推荐用到了content
        2. 前端虽然都是jsp，但请求格式不一样。浏览器插件基本上是  title | url 这样一个请求字符串，用到的jsp调用逻辑比较复杂,这块前端还在陈威组黄炳程那里负责，需要管最终的样式。
而新闻页是一个xml格式，包含url、title、content字段，我们自己负责，不需要管最终样式，结果简单拼接返回即可。现在接口统一使用getrcmdres.jsp
        3. 打到后端server的字段req_type_id用来区分请求类型

六、新闻推荐线上封禁  
        1. 紧急封禁
            联系产品同学，小P联系网安的同学通过UMIS系统
            针对一个query   进行URL查询 （得到推荐了该query的urls）   点击下线的话，将这些url作为参数触发我们的接口，我们的接口调用合作方的接口
        2. 黑名单过滤
            可以添加到黑名单中，随index每日上线过滤，黑名单参考：
        3.现在pcsohu,pcqq都迁移到了iehint模块上，iehint可以用旧的umis黑掉，链接
            数据同步文件在 s3://上，使用命令yunpan-cli cp s3://，参考
        4.旧的umis上的iehint封禁模块:

七：UMIS系统几大门户网站的干预策略
        线下调试是在： 对应代码SVN在58机器上  
手机搜狐  pc搜狐 手机腾讯  三个接口整合在一个JSP中，这样UMIS就可以同时对三个同时生效
        线下调试机器：
遇到的问题与对应解决方法
（1）特定站点黑名单过滤
        可以在加黑名单（域名或者具体的网页URL） 放在索引同步目录下，或者提单子上线生效
（2）增加一些站点的插件展现
        使用站点白名单，将需要新增的要出插件的站点放在白名单中，白名单是一个id文件（白名单的url都转成了id的格式）见：
        线上的配置文件见：
        生成site的id的方法：输入文件格式为每行一个url


#重构及优化
一些想到的点先列在这里
nginx将请求路由到不同机器的resin。resin将请求路由到不同机器的iehint或银河游戏接口。
resin有连接银河游戏和iehint，银河游戏主要用于浏览器插件在特定域名下给游戏推荐样式和结果。其他情况主要以socket接口请求iehint。iehint接口和图谱推荐的hint接口基本类似。
不同渠道在iehint里主要以reqtype区分，可能有若干个渠道共享同一个reqtype。渠道和reqtype的对应由不同的jsp处理，不排除有其他逻辑进行请求的判断，这块如果重构需要梳理清楚。
iehint除了本身的推荐逻辑之外，有连接图谱推荐。特定reqtype会请求图谱推荐结果。
现在reqtype的分布比例如下，第一列为reqtype值，第二列为一小时内单服务器请求个数。重构时可以重点关注reqtype=0,2,15的情况，reqtype=12的请求似乎主要来源于xiangha，可以问下产品，如果没什么点击量的话可以考虑将连图谱推荐的逻辑下掉。
